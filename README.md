# چطور تور رو روی دبیان-بیس‌ها راه بندازیم

می‌دونم عجله دارید و کارتون لنگ مونده، پس قسمت خزعبلات تاریخی اینکه اصولاً چرا باید از تور یا همچین ابزارهایی استفاده بکنیم یا چرا اصلاً تور ساخته شد و اینا ... رو فاکتور می‌گیرم و مستقیم می‌رم سراغ دستور پخت.

## نصب تور

پکیج منیجر دبیان تور رو داره، این قسمت(اگه پکیجش رو هم فیلتر نکرده باشن البته) آسون ترین قسمته.
```
sudo apt-get install tor tor-geoipdb obfs4proxy
```

### اگر فیلتر شده بود...

در صورتی که بسته‌ی دبیان تور  رو فیلتر کرده باشن، موقع دانلودش ۴۰۳ می‌ده(۴۰۴ نه‌ها! اگه ۴۰۴ داد لیست برنامه‌هاتون رو به روز کنین) و باید آدرس بسته‌ی تور رو موقع دادن خطا کپی کنین و برین با یه روش دیگه دانلودش کنین و با dpkg نصب کنین. این مدلی:

```
sudo dpkg -i tor_VERSION_ARCH.deb
```

یادتون نره که *VERSION* و *ARCH* بستگی به نسخه و معماری بسته‌ای که گرفتین داره.  

اگر اینترنت معقولی دارید و سرعتتون لاک‌پشتی نیست و سیستمتون از همون اول که روشن می‌شه به شبکه وصله از سرویس تور استفاده کنین دردسرش کم‌تره. از قسمت **خاموش نکردن سرویس تور** ادامه بدین.

## خاموش کردن سرویس تور

و اگر اینترنت معقولی ندارید و کاملاً اسلامیزه‌ست هیچ اشکالی نداره - فقط دردسرش یکم بیش‌تره. سرویس تور رو در این شرایط غیرفعال کنین بهتره چون فقط سعی می‌کنه با این کانکشن ناپایداری که دارید وصل بشه و نمی‌تونه. دستی یا با یه رابط دیگه(مثل ویدالیا یا آرم - قسمت **رابط‌های کاربری** رو ببینین) راحت‌ترین. دبیان از نسخه‌ی هشت به اینور از سیستم‌دی استفاده می‌کنه که خب انصافاً نسبت به آپ‌استارت و دوستان راحت‌تره. اول سرویس رو خاموش می‌کنیم بعد غیر فعالش می‌کنیم:

```
sudo systemctl stop tor.service
sudo systemctl disable tor.service
```

و یا در صورتی که از همون آپ‌استارت قدیمی استفاده می‌کنید:

```
sudo service tor stop
sudo update-rc.d tor disable
```

## خاموش نکردن سرویس تور

این‌جا لازم نیست کار خاصی بکنین. فقط باید بدونین که از وقتی سیستم رو روشن می‌کنین(حتی قبل از لاگین کردن) تور داره با کاربری `debian-tor‍` اجرا می‌شه. در این صورت علاوه بر این که لازم نیست هیچ کار دیگه‌ای جز روشن کردن پروکسی(قسمت **تنظیم پروکسی** رو ببینین) بکنین باید توجه کنین که از *هیچ* کدوم از رابط‌های کاربری نمی‌تونین استفاده کنین جز این که کاربری‌ای که تور تحت اون داره اجرا می‌شه رو عوض کنین که نیازی به این کار نیست اصلا - یکباره سرویس رو خاموش کنین دیگه :) احتمالاً راه‌های بهتری برای کنترل تور توی این شرایط هم هست ولی خب من بلد نیستم.

## گرفتن پل‌ها

دوتا راه داریم:

- رفتن به [BridgeBD](https://bridges.torproject.org/)
- درخواست پل از [ایمیل تور](mailto:bridges@torproject.org)

خوبی روش اول اینه که خیلی سریع پل‌ها رو بعد از وارد کردن یکی دوتا کپچا بهتون می‌ده، ولی خب صداش رو در نیارین خیلی چون دیر یا زود شناسایی  و بسته می‌شه. توصیه‌ی من هم راه دوم هست و ایمیل رو هیچ جوری نمی‌شه بست اما فقط با یکی دوتا سرویس شناخته‌شده‌ی ایمیل می‌شه این کار رو انجام داد. یه ایمیل می‌زنین با عنوان و متن `get transport obfs4` و بعد از چندین دقیقه آدرس پل‌ها رو براتون می‌فرسته.

## پیکربندی تور
توی دبیان پیکربندی اصلی تور(که هم درحالت سرویس هم در غیر اون حالت خونده می‌شه) توی این مسیر هست:

```
/etc/tor/torrc
```

تنها کاری که باید با پیکربندی انجام بدیم وارد کردن پل‌هاست. `UseBridges` که از اسمش معلومه. `Use Bridge obfs4 blah blah` هم آدرس پل رو به تور معرفی می‌کنه، و در نهایت `ClientTransportPlugin` هم افزونه‌ی obfsproxy رو به تور متصل می‌کنه. دستورات زیر و وارد کنین. ترتیبشون مهمه طبق معمول :)

```
sudo -i
cat >> /etc/tor/torrc << EOF
UseBridges 1
Bridge obfs4 ip.ad.dre.ss:port blah blah
ClientTransportPlugin obfs4 exec /usr/bin/obfs4proxy
EOF
```

به جای `...ip.ad` و بقیه‌ش اون خطوطی رو که به عنوان پل گرفتین رو بذارین. توصیه‌ی من اینه که **هیچ** قسمتی از اون خطوط رو حذف نکنین و هر سه خط رو وارد کنین.

## رابط‌های کاربری برای تور

### خط فرمان 3>
ساده‌ترین رابط کاربری که فقط روشن-خاموش رو ساپورت می‌کنه همون خط فرمان خودمونه. به همین سادگی:

```
tor
```

و اگر خواستی متوقفش کنین کنترل(`Ctrl`) رو نگه دارین و `C` رو فشار بدین.

### آرم

یه رابط کاربری پیچیده‌تر با استفاده از `ncurses` هست به اسم arm و توی بسته‌ی `tor-arm` هست. وقتی نصبش کردین بنویسین `arm` و خودش تور رو اجرا می‌کنه. نمایش پهنای باند و ترافیک و ازین جنگولک بازیا هم داره :)

### ویدالیا :|

یکی از منفورترین رابط‌های کاربری برای تور، چون هم تا حدودی خنگه هم چون گرافیکیه! دریاره‌ش توضیح نمی‌دم چون گرافیکیه و علاوه بر این که برای نشون دادن یه دکمه باید دم به ثانیه نماگرفت بگیرم و ببرم و ... ، باید دنبال یه جایی برای آپلودشون هم باشم. در حد معرفی گفتم که بدونین قراره با چه چیزی برخورد کنین. آموزشش هم توی اینترنت زیاده هم فیلتر نیست.

## راه انداختن پریواکسی

خوبی پریواکسی اینه که تبلیغات و لینک‌های زرد رو هم بلاک می‌کنه. ولی این‌جا ما فقط ازش به عنوان تبدیل کننده‌ی پروکسی ساکس به اچ‌تی‌تی‌پی استفاده می‌کنیم. اول نصب، بعد پیکربندی و ریفرش.

```
sudo -i
apt-get install privoxy
cat >> /etc/privoxy/config << EOF
forward-socks5 / 127.0.0.1:9050 .
forward-socks5 192.168.*.*/ .
forward-socks5 10.*.*.*/ .
forward-socks5 127.*.*.*/ .
forward-socks5 localhost/ .
EOF
systemctl reload privoxy.service
```

## استفاده از تور

خب، تور الآن آماده‌ی استفاده‌ست. ولی چطوری استفاده‌ش کنیم حالا؟

### خط فرمان

ما یه متغییر محیطی داریم به اسم `HTTP_PROXY` و دوستانش که می‌شن ftp و https و اینا. یه متغییر دیگه هم هست که همه‌ی این کارها رو با هم می کنه: `ALL_PROXY`. بعضی از برنامه‌ها گاهی گیج‌بازی درمیارن و با آخریه کار نمی‌کنن که مجبور می‌شیم هم `HTTP_PROXY` رو ست کنیم و هم `ALL_PROXY` رو. بریم!

```
export HTTP_PROXY=localhost:8118
export HTTPS_PROXY=localhost:8118
export ALL_PROXY=localhost:8118
```

بعد از وارد کردن این سه خط، برنامه‌هایی که پروکسی پشتیبانی می‌کنن(از جمله آریا۲ و دبلیوگت) از تور استفاده می‌کنن. بهتره که اینا رو وارد `bashrc./~` کنین تا هربار لازم نباشه بیاین این‌جا!

### فایرفاکس(و حومه)

فایرفاکس خودش پروکسی رو ساپورت می‌کنه. برای تنظیم کردنش برید به `Preferences > Advanced > Network > Connection > Settings` و اون‌جا برای اسم هاست `localhost`  و برای پورت `8118` رو وارد کنین. اگر هم با این روش راحت نیستین می‌تونین از افزونه‌هایی مثل `FoxyProxy` استفاده کنین که راحت‌ترن و خوش‌دست تر.
