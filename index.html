<html>
<head>
<title>How to Tor</title>
<style type="text/css">
html, body {
  direction: rtl;
}
</style>
</head>
<body>
<h1>چطور تور رو روی دبیان-بیس‌ها راه بندازیم</h1>
<p>می‌دونم عجله دارید و کارتون لنگ مونده، پس قسمت خزعبلات تاریخی اینکه اصولاً چرا باید از تور یا همچین ابزارهایی استفاده بکنیم یا چرا اصلاً تور ساخته شد و اینا ... رو فاکتور می‌گیرم و مستقیم می‌رم سراغ دستور پخت.</p>
<h2>نصب تور</h2>
<p>پکیج منیجر دبیان تور رو داره، این قسمت(اگه پکیجش رو هم فیلتر نکرده باشن البته) آسون ترین قسمته.
<code>sudo apt-get install tor tor-geoipdb obfs4proxy</code></p>
<h3>اگر فیلتر شده بود...</h3>
<p>در صورتی که بسته‌ی دبیان تور  رو فیلتر کرده باشن، موقع دانلودش ۴۰۳ می‌ده(۴۰۴ نه‌ها! اگه ۴۰۴ داد لیست برنامه‌هاتون رو به روز کنین) و باید آدرس بسته‌ی تور رو موقع دادن خطا کپی کنین و برین با یه روش دیگه دانلودش کنین و با dpkg نصب کنین. این مدلی:</p>
<p><code>sudo dpkg -i tor_VERSION_ARCH.deb</code></p>
<p>یادتون نره که <em>VERSION</em> و <em>ARCH</em> بستگی به نسخه و معماری بسته‌ای که گرفتین داره.  </p>
<p>اگر اینترنت معقولی دارید و سرعتتون لاک‌پشتی نیست و سیستمتون از همون اول که روشن می‌شه به شبکه وصله از سرویس تور استفاده کنین دردسرش کم‌تره. از قسمت <strong>خاموش نکردن سرویس تور</strong> ادامه بدین.</p>
<h2>خاموش کردن سرویس تور</h2>
<p>و اگر اینترنت معقولی ندارید و کاملاً اسلامیزه‌ست هیچ اشکالی نداره - فقط دردسرش یکم بیش‌تره. سرویس تور رو در این شرایط غیرفعال کنین بهتره چون فقط سعی می‌کنه با این کانکشن ناپایداری که دارید وصل بشه و نمی‌تونه. دستی یا با یه رابط دیگه(مثل ویدالیا یا آرم - قسمت <strong>رابط‌های کاربری</strong> رو ببینین) راحت‌ترین. دبیان از نسخه‌ی هشت به اینور از سیستم‌دی استفاده می‌کنه که خب انصافاً نسبت به آپ‌استارت و دوستان راحت‌تره. اول سرویس رو خاموش می‌کنیم بعد غیر فعالش می‌کنیم:</p>
<p><code>sudo systemctl stop tor.service
sudo systemctl disable tor.service</code></p>
<p>و یا در صورتی که از همون آپ‌استارت قدیمی استفاده می‌کنید:</p>
<p><code>sudo service tor stop
sudo update-rc.d tor disable</code></p>
<h2>خاموش نکردن سرویس تور</h2>
<p>این‌جا لازم نیست کار خاصی بکنین. فقط باید بدونین که از وقتی سیستم رو روشن می‌کنین(حتی قبل از لاگین کردن) تور داره با کاربری <code>debian-tor‍</code> اجرا می‌شه. در این صورت علاوه بر این که لازم نیست هیچ کار دیگه‌ای جز روشن کردن پروکسی(قسمت <strong>تنظیم پروکسی</strong> رو ببینین) بکنین باید توجه کنین که از <em>هیچ</em> کدوم از رابط‌های کاربری نمی‌تونین استفاده کنین جز این که کاربری‌ای که تور تحت اون داره اجرا می‌شه رو عوض کنین که نیازی به این کار نیست اصلا - یکباره سرویس رو خاموش کنین دیگه :) احتمالاً راه‌های بهتری برای کنترل تور توی این شرایط هم هست ولی خب من بلد نیستم.</p>
<h2>گرفتن پل‌ها</h2>
<p>دوتا راه داریم:</p>
<ul>
<li>رفتن به <a href="https://bridges.torproject.org/">BridgeBD</a></li>
<li>درخواست پل از <a href="mailto:bridges@torproject.org">ایمیل تور</a></li>
</ul>
<p>خوبی روش اول اینه که خیلی سریع پل‌ها رو بعد از وارد کردن یکی دوتا کپچا بهتون می‌ده، ولی خب صداش رو در نیارین خیلی چون دیر یا زود شناسایی  و بسته می‌شه. توصیه‌ی من هم راه دوم هست و ایمیل رو هیچ جوری نمی‌شه بست اما فقط با یکی دوتا سرویس شناخته‌شده‌ی ایمیل می‌شه این کار رو انجام داد. یه ایمیل می‌زنین با عنوان و متن <code>get transport obfs4</code> و بعد از چندین دقیقه آدرس پل‌ها رو براتون می‌فرسته.</p>
<h2>پیکربندی تور</h2>
<p>توی دبیان پیکربندی اصلی تور(که هم درحالت سرویس هم در غیر اون حالت خونده می‌شه) توی این مسیر هست:</p>
<p><code>/etc/tor/torrc</code></p>
<p>تنها کاری که باید با پیکربندی انجام بدیم وارد کردن پل‌هاست. <code>UseBridges</code> که از اسمش معلومه. <code>Use Bridge obfs4 blah blah</code> هم آدرس پل رو به تور معرفی می‌کنه، و در نهایت <code>ClientTransportPlugin</code> هم افزونه‌ی obfsproxy رو به تور متصل می‌کنه. دستورات زیر و وارد کنین. ترتیبشون مهمه طبق معمول :)</p>
<p><code>sudo -i
cat &gt;&gt; /etc/tor/torrc &lt;&lt; EOF
UseBridges 1
Bridge obfs4 ip.ad.dre.ss:port blah blah
ClientTransportPlugin obfs4 exec /usr/bin/obfs4proxy
EOF</code></p>
<p>به جای <code>...ip.ad</code> و بقیه‌ش اون خطوطی رو که به عنوان پل گرفتین رو بذارین. توصیه‌ی من اینه که <strong>هیچ</strong> قسمتی از اون خطوط رو حذف نکنین و هر سه خط رو وارد کنین.</p>
<h2>رابط‌های کاربری برای تور</h2>
<h3>خط فرمان 3&gt;</h3>
<p>ساده‌ترین رابط کاربری که فقط روشن-خاموش رو ساپورت می‌کنه همون خط فرمان خودمونه. به همین سادگی:</p>
<p><code>tor</code></p>
<p>و اگر خواستی متوقفش کنین کنترل(<code>Ctrl</code>) رو نگه دارین و <code>C</code> رو فشار بدین.</p>
<h3>آرم</h3>
<p>یه رابط کاربری پیچیده‌تر با استفاده از <code>ncurses</code> هست به اسم arm و توی بسته‌ی <code>tor-arm</code> هست. وقتی نصبش کردین بنویسین <code>arm</code> و خودش تور رو اجرا می‌کنه. نمایش پهنای باند و ترافیک و ازین جنگولک بازیا هم داره :)</p>
<h3>ویدالیا :|</h3>
<p>یکی از منفورترین رابط‌های کاربری برای تور، چون هم تا حدودی خنگه هم چون گرافیکیه! دریاره‌ش توضیح نمی‌دم چون گرافیکیه و علاوه بر این که برای نشون دادن یه دکمه باید دم به ثانیه نماگرفت بگیرم و ببرم و ... ، باید دنبال یه جایی برای آپلودشون هم باشم. در حد معرفی گفتم که بدونین قراره با چه چیزی برخورد کنین. آموزشش هم توی اینترنت زیاده هم فیلتر نیست.</p>
<h2>راه انداختن پریواکسی</h2>
<p>خوبی پریواکسی اینه که تبلیغات و لینک‌های زرد رو هم بلاک می‌کنه. ولی این‌جا ما فقط ازش به عنوان تبدیل کننده‌ی پروکسی ساکس به اچ‌تی‌تی‌پی استفاده می‌کنیم. اول نصب، بعد پیکربندی و ریفرش.</p>
<p><code>sudo -i
apt-get install privoxy
cat &gt;&gt; /etc/privoxy/config &lt;&lt; EOF
forward-socks5 / 127.0.0.1:9050 .
forward-socks5 192.168.*.*/ .
forward-socks5 10.*.*.*/ .
forward-socks5 127.*.*.*/ .
forward-socks5 localhost/ .
EOF
systemctl reload privoxy.service</code></p>
<h2>استفاده از تور</h2>
<p>خب، تور الآن آماده‌ی استفاده‌ست. ولی چطوری استفاده‌ش کنیم حالا؟</p>
<h3>خط فرمان</h3>
<p>ما یه متغییر محیطی داریم به اسم <code>HTTP_PROXY</code> و دوستانش که می‌شن ftp و https و اینا. یه متغییر دیگه هم هست که همه‌ی این کارها رو با هم می کنه: <code>ALL_PROXY</code>. بعضی از برنامه‌ها گاهی گیج‌بازی درمیارن و با آخریه کار نمی‌کنن که مجبور می‌شیم هم <code>HTTP_PROXY</code> رو ست کنیم و هم <code>ALL_PROXY</code> رو. بریم!</p>
<p><code>export HTTP_PROXY=localhost:8118
export HTTPS_PROXY=localhost:8118
export ALL_PROXY=localhost:8118</code></p>
<p>بعد از وارد کردن این سه خط، برنامه‌هایی که پروکسی پشتیبانی می‌کنن(از جمله آریا۲ و دبلیوگت) از تور استفاده می‌کنن. بهتره که اینا رو وارد <code>bashrc./~</code> کنین تا هربار لازم نباشه بیاین این‌جا!</p>
<h3>فایرفاکس(و حومه)</h3>
<p>فایرفاکس خودش پروکسی رو ساپورت می‌کنه. برای تنظیم کردنش برید به <code>Preferences &gt; Advanced &gt; Network &gt; Connection &gt; Settings</code> و اون‌جا برای اسم هاست <code>localhost</code>  و برای پورت <code>8118</code> رو وارد کنین. اگر هم با این روش راحت نیستین می‌تونین از افزونه‌هایی مثل <code>FoxyProxy</code> استفاده کنین که راحت‌ترن و خوش‌دست تر.</p>
</body>
